---
title: "Temperature and Freshwater as Methods for Controlling D. Vexillum Biofouling"
author: "Payton Arthur, Haze de Haas, Lauren Gill"
date: "27/11/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Abstract
Paste abstract in here

## Contents
Put in table of contents here

## Libraries

```{r setup, echo=FALSE, warning=FALSE}
library(tidyverse)
library(cowplot)
library(ggplot2)
library(here)
```

## Analyses and Graphs
***
### Reading in Data

```{r}
tunidata <- read.csv("tunicate_master.csv")
```
### Change in mean RGB values

First Check for normality, p-value = 0.3433 normal distribution!
```{r}
shapiro.test(tunidata$X48hr_rgb)
```

Using a linear model for normal distribution - allows you to use random effects and nested effects 

```{r}
tunirgb <- tunidata %>% 
  mutate(exposure_time_s = as.factor(exposure_time_s)) %>% 
  mutate(temperature_c = as.factor(temperature_c))

modrgb <- lm(X48hr_rgb ~ exposure_time_s + water_type + temperature_c + exposure_time_s*water_type*temperature_c + (1|colony_id), family = gaussian, data = tunirgb)
summary(mod)
```

Since model is not influenced by random effects, take this out of the model (stepAIC does not work with random effects) and then reduce model 

```{r}
modrgb <- lm(X48hr_rgb ~ exposure_time_s + water_type + temperature_c + exposure_time_s*water_type*temperature_c, family = gaussian, data = tunirgb)
stepmodrgb <- stepAIC(modrgb, direction = "backward", trace = F)
formula(stepmodrgb)
```

stepAIC has outputted its final, reduced model. Final p values for model output
```{r}
newmodrgb <- lm(X48hr_rgb ~ water_type + temperature_c, data = tunirgb)
summary(newmodrgb)
```


### Mold Cover

Displaying the data as a proportion of overall score with given mold cover scores
```{r}
tuni_stacked = tunidata %>%
  group_by(mold_cover, temperature_c, water_type, exposure_time_s) %>%
  summarise(frequency = n())%>%
  mutate(temperature_c=  as.factor(temperature_c))
```

Stacked bar graphs showing mold cover
```{r}
ggplot(tuni_stacked, aes(y = frequency, x = temperature_c, fill = as.factor(mold_cover))) +
  geom_bar(stat = "identity", position = "fill") +
  facet_grid(as.factor(exposure_time_s) ~ water_type) +
  labs(x ="Temperature (°C)", y = "Frequency")+
  scale_fill_brewer(palette = "Oranges", direction=1) +
  labs(fill = "Mold Cover") +
  theme_cowplot()
```


Examining mold cover data to find the best distribution

```{r}
descdist(tunidata$mold_cover)
fitDist(mold_cover, data = tunidata, type = "realline", try.gamlss = T)
```

Fitdist determined ST1 to be the best distribution, comparing it against a normal distribution to make sure AIC value is lower. AIC value of ST1 = -743.8 while AIC value of normal = 328
```{r}
mST1 <- histDist(tunidata$mold_cover, "ST1", density = T, main = "Skew t (Azzalini type 1)")
mNO <- histDist(tunidata$mold_cover, "NO", density = T, main = "Normal")
GAIC(mST1, mNO)
```


Now creating a full model, reduced model is the same as full model. No factors are significant
```{r}
topmod <- gamlss(mold_cover ~ water_type + temperature_c + exposure_time_s +
water_type*temperature_c*exposure_time_s + random(as.factor(colony_id)), 
family = ST1(), data = tunirgb)

summary(topmod)
```


#Change in Weight over 3 Weeks (compare to post-acclimation)

```{r}
tuni_data1 <- tuni_data %>% mutate(ChangeWetWeight = final_weight_g-post_acclimation_weight_g)

#Visualizing Data

p <- ggplot(tuni_data1, aes(x = exposure_time_s, y = ChangeWetWeight, fill = water_type))+
  labs(x = "Exposure time (s)", y = "Change in wet weight (g)", fill = "Water type")+
#labs(title = "Temperature (°C)")+
  geom_boxplot()

p + facet_grid(cols = vars(temperature_c))

hist(tuni_data1$ChangeWetWeight)
shapiro.test(tuni_data1$ChangeWetWeight)
#p-value = 0.7646 thus follows a normal distribution!
descdist(tuni_data1$ChangeWetWeight)

#Statistics for Change in Weight after 3 Weeks

#Distribution Fitting
fitDist(ChangeWetWeight, data = tuni_data1, type = "realline", try.gamlss = T)
#this also gives normal distribution

#Linear Model
mod_changeweight <- lm(ChangeWetWeight ~ exposure_time_s + water_type + temperature_c + exposure_time_s*water_type*temperature_c, family = gaussian, data = tuni_data1)
summary(mod_changeweight)

#Model Selection
step.mod_changeweight <- stepAIC(mod_changeweight, direction = "backward", trace = F)
summary(step.mod_changeweight)
formula(step.mod_changeweight)

#ChangeWetWeight ~ water_type + temperature_c + water_type:temperature_c

check_model(step.mod_changeweight)
#check model when water_type:temperature_c was present and had major collinearity issues, thus removed water_type:temperature and check model again and collinearity issues were solved

mod_changeweightv2 <- lm(ChangeWetWeight ~ water_type + temperature_c, family = gaussian, data = tuni_data1)
summary(mod_changeweightv2)
#significant p-value for temperature_c90 (p=value = 0.0315)

```

Stats for Survival
```{r}
shapiro.test(tuni_data1$survival)
#p-value = 2.046e-15

fitDist(survival, data = tuni_data1, type = "binom", try.gamlss = T)
#family = BI (binomial)

mod_survival <- gamlss(survival ~ water_type + temperature_c + exposure_time_s + water_type*temperature_c*exposure_time_s + random(as.factor(colony_id)), family = BI, data = tuni_data1)
summary(mod_survival)


step.modsurvival <- stepAIC(mod_survival, direction = "backward", trace = F)
summary(step.modsurvival)
formula(step.modsurvival)

#survival ~ temperature_c

#since temperature is the only explanatory variable - thus we can use Kruskal-Wallis Test to see p-values comparing temperatures to controls
library(FSA)
dunnTest(survival ~ temperature_c, data = tuni_data1)
#Comparison        Z      P.unadj        P.adj
#1    12 - 50 2.481097 1.309786e-02 0.0523914356
#2    12 - 70 4.135162 3.547039e-05 0.0002128223
#3    50 - 70 1.654065 9.811432e-02 0.2943429727
#4    12 - 90 4.135162 3.547039e-05 0.0001773519
#5    50 - 90 1.654065 9.811432e-02 0.1962286485
#6    70 - 90 0.000000 1.000000e+00 1.0000000000

#p-value for 12-90 and 12-70 is significant!
```

