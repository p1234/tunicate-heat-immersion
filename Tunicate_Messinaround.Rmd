---
title: "Tunicate Data"
author: "Hazel de Haas"
date: "10/11/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyr)
library(car)
library(performance)
library(DHARMa)
library(fitdistrplus)
library(gamlss)
library(tidyverse)

tuni_data <- read_delim("tuni_data_final.csv", delim = "," )
tuni_data <- read_delim("tuni_data2.csv", delim = "," )



tuni_data$water_type <- replace(tuni_data$water_type, tuni_data$water_type== "freshwater", "fw" )
tuni_data$water_type <- replace(tuni_data$water_type, tuni_data$water_type== "seawater", "sw" )
tuni_data$exposure_time_s <-replace(tuni_data$exposure_time_s, tuni_data$exposure_time_s== "30", "120")
tun_data <- tun_data %>% 
  dplyr::rename(mold_cover = "mold cover")


#changing to factors 
tuni_data$temperature_c <- as.factor(tuni_data$temperature_c)
tuni_data$water_type <- as.factor(tuni_data$water_type)
tuni_data$exposure_time_s <- as.factor(tuni_data$exposure_time_s)
tun_data$temperature_c <- as.factor(tun_data$temperature_c)
tun_data$water_type <- as.factor(tun_data$water_type)

#removing unnecessary rows
tuni_data <- tuni_data %>%
  select(-c(`3wks_rgb`, `3wks_red`, `3wks_green`, `3wks_blue`, final_rgb, sd_3wks_rbg, sd_3wks_red, sd_3wks_green, sd_3wks_blue))



#this unites columns for one big boxplot
tunicate_data_1 <- unite(tunicate_data, treatment, c(water_type, temperature_c, exposure_time_s)) 

tunicate_data_1 <- tunicate_data_1 %>% mutate(ChangeRGB = `48hr_rgb`-initial_rgb)
tunicate_data_1 <- tunicate_data %>% mutate(weight_change = `48hr_weight` - `initial_weight_g`)
tunicate_data_1 <- tunicate_data_1 %>% mutate(percentchange_red = initial_red/`48hr_red`)

tuni_data_test <- tuni_data %>%
  unite(tuni_data_test, treatment, c(water_type, temperature_c)) 

tuni_data_test <- tuni_data1
  unite(tuni_data_test, treatment, c(water_type, temperature_c)) 

#Box plot of all treatments for change in RGB
ggplot(tunicate_data_1, aes(x = treatment, y = ChangeRGB)) +
         geom_boxplot()

#box plot change in weight for temperature 
ggplot(tunicate_data, aes(x = temperature_c, y = weight_change)) +
   geom_boxplot()

#box plot change in weight for water type
ggplot(tunicate_data, aes(x = water_type, y = weight_change)) +
   geom_boxplot()

#Box plot of all treatments for change in Weight
ggplot(tunicate_data_1, aes(x = treatment, y = percentchange_weight)) +
         geom_boxplot()

#Box plot of all treatments for change in red
ggplot(tunicate_data_1, aes(x = treatment, y = percentchange_red)) +
         geom_boxplot()

#Scatterplot
ggplot(tunicate_data_1, aes(x = treatment, y = percentchange_weight )) +
  geom_point()

#Box plot change in weight 
ggplot(tunicate_data_1, aes(x = treatment, y = weight_change)) +
  geom_boxplot()

#box plot mold cover
ggplot(tun_data, aes(x = temperature_c, y = mold_cover, fill = water_type)) +
  geom_boxplot()


ggplot(tuni_data, aes(x = temperature_c, y = survival)) + 
  geom_count(aes(size = after_stat(prop), group = 1)) +
  scale_size_area(max_size = 10) + 
  theme_classic()

ggplot(tuni_data_test, aes(x = treatment, y = survival)) + 
  geom_jitter(width = 0.10, height = 0.05) +
  theme_classic()
```

library(patchwork)
  
```

```{r}
p1 = ggplot(tunicate_data_1, aes(x = treatment, y = initial_rgb)) +
  geom_boxplot() +
  
p2 = ggplot(tunicate_data_1, aes(x = treatment, y = "48hr_rgb")) +
  geom_boxplot() +
  
p1 + p2
```

```{r}
#code along with Sara Nov. 11th 

library(goft)
library(performance)
library(tidyverse)
library(MASS)

tuni_data <- tunicate_data %>%
  dplyr::select(-c(final_weight_g, final_rgb)) %>%
  mutate(exposure_time_s = as.factor(exposure_time_s),
         temperature_c = as.factor(temperature_c))


shapiro.test(tuni_data$`48hr_rgb`)
#p-value = 0.3433 normal distribution!

#use a glm for normal distribution - allows you to use random effects and nested effects 

mod <- lm(`48hr_rgb` ~ exposure_time_s + water_type + temperature_c + exposure_time_s*water_type*temperature_c, family = gaussian, data = tuni_data)

#this model has too many terms - colinearity issues

#are initial rgb values different between colonies? this would effect initial_rgb/colony_id - use id_number instead

check_model(mod)
summary(mod)

step.mod <- stepAIC(mod, direction = "backward", trace = F)
#this should give us a simpler formula
summary(step.mod)
formula(step.mod)
# 48hr_rgb ~ water_type + temperature_c

#Using 48hr weight as response variable

shapiro.test(tuni_data$`48hr_weight`)
#shapiro-wilk normality test < 0.05 thus doesn't follow normal distribution 

hist(tuni_data$`48hr_weight`)
descdist(tuni_data$`48hr_weight`)
# on line for gamma, close to beta and lognormal, weibull is close to gamma and lognormal

mGA <- histDist(tuni_data$`48hr_weight`, "GA", density = T, main = "Gamma")
mlN <- histDist(tuni_data$`48hr_weight`, "LOGNO", density = T, main = "lNorm")
mWE <- histDist(tuni_data$`48hr_weight`, "WEI", density = T, main = "Weibull")

GAIC(mGA, mlN, mWE)
#lognormal has lower GAIC value thus it is the best fit

mod4 <- lm(`48hr_weight` ~ exposure_time_s + water_type + temperature_c + exposure_time_s*water_type*temperature_c, data = tuni_data)
summary(mod2)

step.mod2 <- stepAIC(mod2, direction = "backward", trace = F)
summary(step.mod2)
formula(step.mod2)

#run generalized linear model

```

Stats for Attachment
```{r}
fitDist(attachment, data = tuni_data1, type = "binom", try.gamlss = T)
#family = BI (binomial)

tuni_data1 = tuni_data %>%
  select(-c(final_weight_g...12, initial_blue))

mod <- gamlss(attachment ~ water_type + temperature_c + exposure_time_s + water_type*temperature_c*exposure_time_s, family = BI, data = tuni_data1)
summary(mod)

step.mod <- stepAIC(mod, direction = "backward", trace = F)
summary(step.mod)
formula(step.mod)

#attachment ~ temperature_c

#nothing significant
```

Stats for Wet Weight
```{r}
shapiro.test(tuni_data1$final_weight_g...42)
#p-value = 0.026, doesn't follow normal distribution

fitDist(final_weight_g...42, data = tuni_data1, type = "realAll", try.gamlss = T)
#family = WEI, Weibull

mod2 <- gamlss(final_weight_g...42 ~ water_type + temperature_c + exposure_time_s + water_type*temperature_c*exposure_time_s, family = WEI, data = tuni_data1)
summary(mod2)

#water_typesw:temperature_c90 is significant, water_typesw:temperature_c90:exposure_time_s60 is almost significant

step.mod2 <- stepAIC(mod2, direction = "backward", trace = F)
summary(step.mod2)
formula(step.mod2)

#final_weight_g...42 ~ temperature_c

```

Stats for Survival
```{r}
fitDist(survival, data = tuni_data1, type = "binom", try.gamlss = T)
#family = BI (binomial)

mod3 <- gamlss(survival ~ water_type + temperature_c + exposure_time_s + `48hr_rgb` + water_type*temperature_c*exposure_time_s, family = BI, data = tuni_data1)
summary(mod)

model3 <-

step.mod3 <- stepAIC(mod3, direction = "backward", trace = F)
summary(step.mod3)
formula(step.mod3)

#survival ~ temperature

```

```{r}

```

